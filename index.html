<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="TaskDay - Gerencie suas tarefas de forma eficiente">
  <title>TaskDay</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Estilos customizados -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--primary-color);display:flex;align-items:center;justify-content:center;z-index:9999;transition:opacity 0.5s;">
    <h1 style="color:var(--secondary-color);font-size:4rem;animation:splashFade 2s ease-in-out;">TaskDays</h1>
  </div>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#"><i class="fa-solid fa-calendar-check"></i> TaskDay</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto" id="navbar-links">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Tarefas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Calendário</a>
          </li>
          <li class="nav-item" id="nav-login">
            <a class="nav-link" href="#">Login</a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto" id="navbar-user" style="display:none;">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <span id="navbar-welcome"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="#">Atividades</a></li>
              <li><a class="dropdown-item" href="#">Perfil</a></li>
              <li><a class="dropdown-item" href="#">Conquistas</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="navbar-logout">Sair</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Tela de Login -->
  <main class="container d-flex flex-column justify-content-center align-items-center" style="min-height:80vh;">
    <!-- Toast de notificação -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index:11000">
      <div id="toastNotificacao" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body" id="toastNotificacaoBody"></div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>
    <!-- Tela de Conquistas -->
    <div id="conquistas-card" class="card shadow p-4 w-100" style="max-width:500px; display:none;">
      <h3 class="mb-3 text-center" style="color:var(--primary-color);">Conquistas</h3>
      <ul class="list-group mb-3" id="conquistas-list"></ul>
    </div>
    <!-- Tela de Perfil -->
    <div id="perfil-card" class="card shadow p-4 w-100" style="max-width:500px; display:none;">
      <h3 class="mb-3 text-center" style="color:var(--primary-color);">Perfil do Usuário</h3>
      <div class="mb-3 text-center">
        <span class="fw-bold">Nome:</span> <span id="perfil-nome"></span><br>
        <span class="fw-bold">Email:</span> <span id="perfil-email"></span><br>
        <span class="fw-bold">Nível:</span> <span id="perfil-nivel"></span><br>
        <span class="fw-bold">Pontos:</span> <span id="perfil-pontos"></span><br>
      </div>
      <div class="mb-3">
        <span class="fw-bold">Conquistas desbloqueadas:</span>
        <ul id="perfil-conquistas" class="list-group mb-2"></ul>
      </div>
      <div class="mb-3">
        <span class="fw-bold">Estatísticas do histórico:</span>
        <ul class="list-group">
          <li class="list-group-item">Tarefas concluídas na semana: <span id="perfil-concluidas-semana"></span></li>
          <li class="list-group-item">Tarefas pendentes na semana: <span id="perfil-pendentes-semana"></span></li>
          <li class="list-group-item">Tarefas concluídas no mês: <span id="perfil-concluidas-mes"></span></li>
          <li class="list-group-item">Tarefas pendentes no mês: <span id="perfil-pendentes-mes"></span></li>
        </ul>
      </div>
    </div>
    <!-- Login e Cadastro -->
    <div id="login-card" class="card shadow p-4 w-100" style="max-width:350px;">
      <h2 class="mb-4 text-center" style="color:var(--primary-color);">Entrar</h2>
      <form id="login-form">
        <div class="mb-3">
          <label for="login-email" class="form-label">Email</label>
          <input type="email" class="form-control" id="login-email" placeholder="Digite seu email" required>
        </div>
        <div class="mb-3">
          <label for="login-senha" class="form-label">Senha</label>
          <input type="password" class="form-control" id="login-senha" placeholder="Digite sua senha" required>
        </div>
        <button type="submit" class="btn btn-primary w-100 mb-2">Entrar</button>
        <a href="#" id="show-cadastro" class="d-block text-center mb-2" style="color:var(--secondary-color);">Cadastrar</a>
        <button type="button" class="btn btn-outline-dark w-100"><i class="fa-brands fa-google"></i> Entrar com Google</button>
      </form>
    </div>
    <div id="cadastro-card" class="card shadow p-4 w-100" style="max-width:350px; display:none;">
      <h2 class="mb-4 text-center" style="color:var(--primary-color);">Cadastro</h2>
      <form id="cadastro-form">
        <div class="mb-3">
          <label for="cadastro-nome" class="form-label">Nome completo</label>
          <input type="text" class="form-control" id="cadastro-nome" placeholder="Digite seu nome" required>
        </div>
        <div class="mb-3">
          <label for="cadastro-email" class="form-label">Email</label>
          <input type="email" class="form-control" id="cadastro-email" placeholder="Digite seu email" required>
        </div>
        <div class="mb-3">
          <label for="cadastro-senha" class="form-label">Senha</label>
          <input type="password" class="form-control" id="cadastro-senha" placeholder="Digite sua senha" required>
        </div>
        <button type="submit" class="btn btn-primary w-100 mb-2">Criar conta</button>
        <a href="#" id="voltar-login" class="d-block text-center mb-2" style="color:var(--secondary-color);">Voltar ao login</a>
      </form>
    </div>
    <!-- Tela de Atividades -->
    <div id="atividades-card" class="card shadow p-4 w-100" style="max-width:500px; display:none;">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0" id="data-dia"></h3>
        <button class="btn btn-success" id="btn-add-atividade"><i class="fa-solid fa-plus"></i> Adicionar atividade</button>
      </div>
      <ul class="list-group" id="lista-atividades"></ul>
    </div>
    <!-- Modal Adicionar/Editar -->
    <div class="modal fade" id="modalAtividade" tabindex="-1" aria-labelledby="modalAtividadeLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="form-atividade">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAtividadeLabel">Adicionar atividade</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="nome-atividade" class="form-label">Nome da atividade</label>
                <input type="text" class="form-control" id="nome-atividade" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Dia(s) da semana</label><br>
                <div id="dias-semana-checkboxes" class="d-flex flex-wrap gap-2">
                  <!-- checkboxes -->
                </div>
              </div>
              <div class="mb-3">
                <label for="hora-inicio" class="form-label">Horário de início</label>
                <input type="time" class="form-control" id="hora-inicio" required>
              </div>
              <div class="mb-3">
                <label for="hora-fim" class="form-label">Horário de término</label>
                <input type="time" class="form-control" id="hora-fim" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-success">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Modal de confirmação -->
    <div class="modal fade" id="modalConfirm" tabindex="-1" aria-labelledby="modalConfirmLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalConfirmLabel">Confirmar exclusão</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Tem certeza que deseja excluir esta atividade?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-danger" id="btn-confirm-excluir">Excluir</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal motivacional -->
    <div class="modal fade" id="modalMotivacional" tabindex="-1" aria-labelledby="modalMotivacionalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalMotivacionalLabel">Parabéns!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Você concluiu uma atividade! Continue assim!
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- JS customizados -->
  <script src="js/main.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/calendar.js"></script>
  <script>
      // Notificações de início de tarefas
      function verificarNotificacoesAtividades() {
        if(!usuarioLogado) return;
        var atividades = getAtividades();
        var hoje = diaAtualSemana();
        var agora = new Date();
        var horaAtual = agora.getHours().toString().padStart(2, '0') + ':' + agora.getMinutes().toString().padStart(2, '0');
        atividades.forEach(function(atividade, idx) {
          if(atividade.dias.includes(hoje)) {
            // Notificar 5 minutos antes do início
            var horaInicio = atividade.horaInicio;
            var dtInicio = new Date(agora);
            var [h, m] = horaInicio.split(':');
            dtInicio.setHours(parseInt(h));
            dtInicio.setMinutes(parseInt(m));
            dtInicio.setSeconds(0);
            var dtNotificar = new Date(dtInicio.getTime() - 5*60000);
            if(
              agora.getHours() === dtNotificar.getHours() &&
              agora.getMinutes() === dtNotificar.getMinutes()
            ) {
              mostrarToast(`A atividade "${atividade.nome}" começa em 5 minutos!`);
            }
          }
        });
      }
      setInterval(verificarNotificacoesAtividades, 60000); // verifica a cada minuto

      // Toast helper
      function mostrarToast(msg) {
        var toastBody = document.getElementById('toastNotificacaoBody');
        toastBody.textContent = msg;
        var toastEl = document.getElementById('toastNotificacao');
        var toast = new bootstrap.Toast(toastEl);
        toast.show();
      }
    // Splash screen animation
    window.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        var splash = document.getElementById('splash');
        splash.style.opacity = '0';
        setTimeout(function(){ splash.style.display = 'none'; }, 500);
      }, 2000);
    // Alternar entre login, cadastro e atividades, autenticação e CRUD de atividades
    document.addEventListener('DOMContentLoaded', function() {
      var showCadastro = document.getElementById('show-cadastro');
      var voltarLogin = document.getElementById('voltar-login');
      var loginCard = document.getElementById('login-card');
      var cadastroCard = document.getElementById('cadastro-card');
      var atividadesCard = document.getElementById('atividades-card');
      var loginForm = document.getElementById('login-form');
      var cadastroForm = document.getElementById('cadastro-form');
      var navbarLinks = document.getElementById('navbar-links');
      var navbarUser = document.getElementById('navbar-user');
      var navbarWelcome = document.getElementById('navbar-welcome');
      var navLogin = document.getElementById('nav-login');
      var navbarLogout = document.getElementById('navbar-logout');
      var listaAtividades = document.getElementById('lista-atividades');
      var btnAddAtividade = document.getElementById('btn-add-atividade');
      var modalAtividade = new bootstrap.Modal(document.getElementById('modalAtividade'));
      var modalConfirm = new bootstrap.Modal(document.getElementById('modalConfirm'));
      var modalMotivacional = new bootstrap.Modal(document.getElementById('modalMotivacional'));
      var formAtividade = document.getElementById('form-atividade');
      var diasSemanaCheckboxes = document.getElementById('dias-semana-checkboxes');
      var dataDia = document.getElementById('data-dia');
      var usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado') || 'null');
      var editIndex = null;
      var excluirIndex = null;
      var ultimoDia = localStorage.getItem('ultimoDia') || '';
      var historico = JSON.parse(localStorage.getItem('historico_' + (usuarioLogado ? usuarioLogado.email : '')) || '{}');
      var pontosConsecutivos = parseInt(localStorage.getItem('pontosConsecutivos_' + (usuarioLogado ? usuarioLogado.email : '')) || '0');
      var diaConcluido = false;

      // Alternância de telas
      function mostrarTelaLogin() {
        loginCard.style.display = 'block';
        cadastroCard.style.display = 'none';
        atividadesCard.style.display = 'none';
      }
      function mostrarTelaCadastro() {
        loginCard.style.display = 'none';
        cadastroCard.style.display = 'block';
        atividadesCard.style.display = 'none';
      }
      function mostrarTelaAtividades() {
        loginCard.style.display = 'none';
        cadastroCard.style.display = 'none';
        atividadesCard.style.display = 'block';
        renderAtividades();
      }
      if(showCadastro) showCadastro.onclick = function(e) { e.preventDefault(); mostrarTelaCadastro(); };
      if(voltarLogin) voltarLogin.onclick = function(e) { e.preventDefault(); mostrarTelaLogin(); };

      // Cadastro funcional
      if(cadastroForm) {
        cadastroForm.onsubmit = function(e) {
          e.preventDefault();
          var nome = document.getElementById('cadastro-nome').value;
          var email = document.getElementById('cadastro-email').value;
          var senha = document.getElementById('cadastro-senha').value;
          var usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
          usuarios.push({ nome, email, senha });
          localStorage.setItem('usuarios', JSON.stringify(usuarios));
          alert('Cadastro realizado com sucesso!');
          mostrarTelaLogin();
        };
      }
      // Autenticação de login
      function autenticar(email, senha) {
        var usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
        var usuario = usuarios.find(u => u.email === email && u.senha === senha);
        return usuario || null;
      }
      function mostrarUsuario(usuario) {
        if(navbarLinks) navbarLinks.style.display = 'none';
        if(navbarUser) navbarUser.style.display = 'flex';
        if(navbarWelcome) navbarWelcome.textContent = `Bem-vindo(a), ${usuario.nome}`;
        mostrarTelaAtividades();
      }
      function esconderUsuario() {
        if(navbarLinks) navbarLinks.style.display = '';
        if(navbarUser) navbarUser.style.display = 'none';
        if(navbarWelcome) navbarWelcome.textContent = '';
        mostrarTelaLogin();
      }
      // Persistência de login
      if(usuarioLogado) {
        mostrarUsuario(usuarioLogado);
      }
      // Login
      if(loginForm) {
        loginForm.onsubmit = function(e) {
          e.preventDefault();
          var email = document.getElementById('login-email').value;
          var senha = document.getElementById('login-senha').value;
          var usuario = autenticar(email, senha);
          if(usuario) {
            localStorage.setItem('usuarioLogado', JSON.stringify(usuario));
            mostrarUsuario(usuario);
          } else {
            alert('Email ou senha inválidos!');
          }
        };
      }
      // Logout
      if(navbarLogout) {
        navbarLogout.onclick = function(e) {
          e.preventDefault();
          localStorage.removeItem('usuarioLogado');
          esconderUsuario();
        };
      }

      // Atividades CRUD
      function getAtividades() {
        if(!usuarioLogado) return [];
        var atividades = JSON.parse(localStorage.getItem('atividades_' + usuarioLogado.email) || '[]');
        return atividades;
      }
      function setAtividades(atividades) {
        if(!usuarioLogado) return;
        localStorage.setItem('atividades_' + usuarioLogado.email, JSON.stringify(atividades));
      }
      function diaAtualSemana() {
        return new Date().getDay(); // 0=Dom, 1=Seg, ... 6=Sab
      }
      function dataAtualFormatada() {
        var hoje = new Date();
        return hoje.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });
      }
      function renderAtividades() {
        if(dataDia) dataDia.textContent = dataAtualFormatada();
        var atividades = getAtividades();
        var hoje = diaAtualSemana();
        listaAtividades.innerHTML = '';
        var concluidasHoje = 0;
        var totalHoje = 0;
        atividades.forEach(function(atividade, idx) {
          if(atividade.dias.includes(hoje)) {
            totalHoje++;
            var concluida = historico[dataAtualFormatada()] && historico[dataAtualFormatada()].concluidas && historico[dataAtualFormatada()].concluidas.includes(idx);
            if(concluida) concluidasHoje++;
            var li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `<div>
              <strong>${atividade.nome}</strong><br>
              <small>${atividade.horaInicio} - ${atividade.horaFim}</small>
            </div>
            <div>
              <button class="btn btn-success btn-sm me-1" data-idx="${idx}" data-action="concluir" ${concluida ? 'disabled' : ''}><i class="fa-solid fa-check"></i></button>
              <button class="btn btn-primary btn-sm me-1" data-idx="${idx}" data-action="editar"><i class="fa-solid fa-pen"></i></button>
              <button class="btn btn-danger btn-sm" data-idx="${idx}" data-action="excluir"><i class="fa-solid fa-trash"></i></button>
            </div>`;
            if(concluida) li.classList.add('list-group-item-success');
            listaAtividades.appendChild(li);
          }
        });
        // Pontos extras por dia completo
        if(totalHoje > 0 && concluidasHoje === totalHoje && !diaConcluido) {
          pontosConsecutivos++;
          localStorage.setItem('pontosConsecutivos_' + usuarioLogado.email, pontosConsecutivos);
          diaConcluido = true;
          mostrarToast('Parabéns! Você concluiu todas as atividades do dia!');
        }
      }
      // Dias da semana checkboxes
      if(diasSemanaCheckboxes) {
        var dias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab'];
        diasSemanaCheckboxes.innerHTML = dias.map(function(dia, i){
          return `<div class="form-check">
            <input class="form-check-input" type="checkbox" value="${i}" id="dia${i}">
            <label class="form-check-label" for="dia${i}">${dia}</label>
          </div>`;
        }).join('');
      }
      // Adicionar atividade
      if(btnAddAtividade) btnAddAtividade.onclick = function(){
        editIndex = null;
        document.getElementById('modalAtividadeLabel').textContent = 'Adicionar atividade';
        formAtividade.reset();
        if(diasSemanaCheckboxes) {
          diasSemanaCheckboxes.querySelectorAll('input').forEach(function(cb){ cb.checked = false; });
        }
        modalAtividade.show();
      };
      // Salvar atividade
      if(formAtividade) formAtividade.onsubmit = function(e){
        e.preventDefault();
        var nome = document.getElementById('nome-atividade').value;
        var horaInicio = document.getElementById('hora-inicio').value;
        var horaFim = document.getElementById('hora-fim').value;
        var dias = Array.from(diasSemanaCheckboxes.querySelectorAll('input:checked')).map(cb => parseInt(cb.value));
        if(dias.length === 0) { alert('Selecione pelo menos um dia da semana!'); return; }
        var atividades = getAtividades();
        var atividade = { nome, horaInicio, horaFim, dias };
        if(editIndex !== null) {
          atividades[editIndex] = atividade;
        } else {
          atividades.push(atividade);
        }
        setAtividades(atividades);
        modalAtividade.hide();
        renderAtividades();
      };
      // Editar/Excluir/Concluir
      if(listaAtividades) listaAtividades.onclick = function(e){
        var btn = e.target.closest('button');
        if(!btn) return;
        var idx = parseInt(btn.getAttribute('data-idx'));
        var action = btn.getAttribute('data-action');
        var atividades = getAtividades();
        if(action === 'editar') {
          editIndex = idx;
          var atividade = atividades[idx];
          document.getElementById('modalAtividadeLabel').textContent = 'Editar atividade';
          document.getElementById('nome-atividade').value = atividade.nome;
          document.getElementById('hora-inicio').value = atividade.horaInicio;
          document.getElementById('hora-fim').value = atividade.horaFim;
          diasSemanaCheckboxes.querySelectorAll('input').forEach(function(cb){ cb.checked = atividade.dias.includes(parseInt(cb.value)); });
          modalAtividade.show();
        } else if(action === 'excluir') {
          excluirIndex = idx;
          modalConfirm.show();
        } else if(action === 'concluir') {
          // Histórico de conclusão
          var data = dataAtualFormatada();
          if(!historico[data]) historico[data] = { concluidas: [], pendentes: [] };
          if(!historico[data].concluidas.includes(idx)) historico[data].concluidas.push(idx);
          localStorage.setItem('historico_' + usuarioLogado.email, JSON.stringify(historico));
          modalMotivacional.show();
          renderAtividades();
        }
      };
      // Confirmar exclusão
      document.getElementById('btn-confirm-excluir').onclick = function(){
        var atividades = getAtividades();
        if(excluirIndex !== null) {
          atividades.splice(excluirIndex, 1);
          setAtividades(atividades);
          // Remover do histórico
          Object.keys(historico).forEach(function(data){
            if(historico[data].concluidas) historico[data].concluidas = historico[data].concluidas.filter(i => i !== excluirIndex);
          });
          localStorage.setItem('historico_' + usuarioLogado.email, JSON.stringify(historico));
          renderAtividades();
          modalConfirm.hide();
        }
      };
      // Navegação pelo menu
      document.querySelectorAll('.dropdown-item').forEach(function(item){
        item.onclick = function(e){
          if(item.textContent === 'Atividades') {
            mostrarTelaAtividades();
          }
          if(item.textContent === 'Perfil') {
            mostrarTelaPerfil();
          }
          if(item.textContent === 'Conquistas') {
            mostrarTelaConquistas();
          }
        };
      });

      // Função para mostrar tela de conquistas
      function mostrarTelaConquistas() {
        loginCard.style.display = 'none';
        cadastroCard.style.display = 'none';
        atividadesCard.style.display = 'none';
        var perfilCard = document.getElementById('perfil-card');
        if(perfilCard) perfilCard.style.display = 'none';
        var conquistasCard = document.getElementById('conquistas-card');
        if(conquistasCard) conquistasCard.style.display = 'block';
        renderConquistas();
      }

      // Função para renderizar conquistas
      function renderConquistas() {
        var conquistasList = document.getElementById('conquistas-list');
        if(!usuarioLogado || !conquistasList) return;
        var pontos = pontosConsecutivos;
        var conquistas = [
          { nome: '1 semana completa', desbloqueada: pontos >= 7, requisito: 'Complete 7 dias consecutivos de atividades.' },
          { nome: '1 mês completo', desbloqueada: pontos >= 30, requisito: 'Complete 30 dias consecutivos de atividades.' },
          { nome: '100 dias consecutivos', desbloqueada: pontos >= 100, requisito: 'Complete 100 dias consecutivos de atividades.' },
          { nome: 'Primeira atividade concluída', desbloqueada: pontos > 0, requisito: 'Conclua sua primeira atividade.' }
        ];
        conquistasList.innerHTML = conquistas.map(c => `
          <li class="list-group-item d-flex justify-content-between align-items-center ${c.desbloqueada ? 'list-group-item-success' : ''}">
            <div>
              <strong>${c.nome}</strong><br>
              <small>${c.requisito}</small>
            </div>
            <span class="badge ${c.desbloqueada ? 'bg-success' : 'bg-secondary'}">${c.desbloqueada ? 'Desbloqueada' : 'Pendente'}</span>
          </li>
        `).join('');
      }

      // Função para mostrar tela de perfil
      function mostrarTelaPerfil() {
        loginCard.style.display = 'none';
        cadastroCard.style.display = 'none';
        atividadesCard.style.display = 'none';
        var perfilCard = document.getElementById('perfil-card');
        if(perfilCard) perfilCard.style.display = 'block';
        renderPerfil();
      }

      // Função para renderizar dados do perfil
      function renderPerfil() {
        var perfilNome = document.getElementById('perfil-nome');
        var perfilEmail = document.getElementById('perfil-email');
        var perfilNivel = document.getElementById('perfil-nivel');
        var perfilPontos = document.getElementById('perfil-pontos');
        var perfilConquistas = document.getElementById('perfil-conquistas');
        var perfilConcluidasSemana = document.getElementById('perfil-concluidas-semana');
        var perfilPendentesSemana = document.getElementById('perfil-pendentes-semana');
        var perfilConcluidasMes = document.getElementById('perfil-concluidas-mes');
        var perfilPendentesMes = document.getElementById('perfil-pendentes-mes');
        if(!usuarioLogado) return;
        // Dados básicos
        perfilNome.textContent = usuarioLogado.nome;
        perfilEmail.textContent = usuarioLogado.email;
        var pontos = pontosConsecutivos;
        perfilPontos.textContent = pontos;
        var nivel = Math.floor(pontos / 7) + 1;
        perfilNivel.textContent = nivel;
        // Conquistas
        var conquistas = [];
        if(pontos >= 7) conquistas.push('1 semana completa');
        if(pontos >= 30) conquistas.push('1 mês completo');
        if(pontos >= 100) conquistas.push('100 dias consecutivos');
        perfilConquistas.innerHTML = conquistas.length ? conquistas.map(c => `<li class='list-group-item'>${c}</li>`).join('') : '<li class="list-group-item">Nenhuma conquista ainda</li>';
        // Estatísticas do histórico
        var hoje = new Date();
        var semanaAtual = getSemanaAno(hoje);
        var mesAtual = hoje.getMonth();
        var concluidasSemana = 0, pendentesSemana = 0, concluidasMes = 0, pendentesMes = 0;
        Object.keys(historico).forEach(function(dataStr){
          var data = parseDataBR(dataStr);
          if(getSemanaAno(data) === semanaAtual) {
            concluidasSemana += historico[dataStr].concluidas ? historico[dataStr].concluidas.length : 0;
            // Pendentes: total do dia - concluidas
            var totalDia = getAtividades().filter(a => a.dias.includes(data.getDay())).length;
            pendentesSemana += Math.max(0, totalDia - (historico[dataStr].concluidas ? historico[dataStr].concluidas.length : 0));
          }
          if(data.getMonth() === mesAtual) {
            concluidasMes += historico[dataStr].concluidas ? historico[dataStr].concluidas.length : 0;
            var totalDia = getAtividades().filter(a => a.dias.includes(data.getDay())).length;
            pendentesMes += Math.max(0, totalDia - (historico[dataStr].concluidas ? historico[dataStr].concluidas.length : 0));
          }
        });
        perfilConcluidasSemana.textContent = concluidasSemana;
        perfilPendentesSemana.textContent = pendentesSemana;
        perfilConcluidasMes.textContent = concluidasMes;
        perfilPendentesMes.textContent = pendentesMes;
      }

      // Helpers para datas
      function getSemanaAno(date) {
        var d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        var dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
      }
      function parseDataBR(str) {
        // Ex: quarta-feira, 14/08/2025
        var parts = str.split(', ');
        var dateParts = parts[1].split('/');
        return new Date(dateParts[2], dateParts[1]-1, dateParts[0]);
      }

      // Troca automática de dia às 00:00
      function verificaTrocaDia() {
        var hoje = dataAtualFormatada();
        if(ultimoDia !== hoje) {
          ultimoDia = hoje;
          localStorage.setItem('ultimoDia', ultimoDia);
          diaConcluido = false;
          renderAtividades();
        }
      }
      setInterval(verificaTrocaDia, 60000); // verifica a cada minuto
      verificaTrocaDia();

      // Reset semanal no domingo à noite ou segunda às 00:00
      function verificaResetSemanal() {
        var hoje = new Date();
        var diaSemana = hoje.getDay();
        var hora = hoje.getHours();
        var minutos = hoje.getMinutes();
        if((diaSemana === 0 && hora === 23 && minutos >= 59) || (diaSemana === 1 && hora === 0 && minutos < 5)) {
          historico = {};
          pontosConsecutivos = 0;
          localStorage.setItem('historico_' + usuarioLogado.email, JSON.stringify(historico));
          localStorage.setItem('pontosConsecutivos_' + usuarioLogado.email, pontosConsecutivos);
        }
      }
      setInterval(verificaResetSemanal, 60000); // verifica a cada minuto
      verificaResetSemanal();
    });
    });
  </script>
  <style>
    @keyframes splashFade {
      0% { opacity: 0; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }
    @media (max-width: 576px) {
      .card { padding: 1.5rem 0.5rem; }
      .card h2 { font-size: 1.5rem; }
      .form-label, .form-control, .btn { font-size: 1rem; }
    }
  </style>
</body>
</html>
